---
title: 牛客论坛项目-会话管理
categories:
- nowcoder
tags:
- forum
- nowcoder
---
<meta name="referrer" content="no-referrer"/>

## 内容

**本节包括：**

- http无状态
- http cookie
- cookie示例

<!--more-->

## 参考链接

[mozilla develop](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A1%8C%E4%B8%BA%E8%B7%9F%E8%B8%AA)

## HTTP 无状态，但并非无会话

HTTP 是无状态的：在同一个连接中，两个执行成功的请求之间是没有关系的。这就带来了一个问题，用户没有办法在同一个网站中进行连贯的交互，比如在电商网站中使用购物车功能。尽管 HTTP 根本上来说是无状态的，但借助 HTTP Cookie 就可使用有状态的会话。利用标头的扩展性，HTTP Cookie 被加进了协议工作流程，每个请求之间就能够创建会话，让每个请求都能共享相同的上下文信息或相同的状态。

## http cookie

HTTP Cookie（也叫 Web Cookie 或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据。浏览器会存储 cookie 并在下次向同一服务器再发起请求时携带并发送到服务器上。**通常，它用于告知服务端两个请求是否来自同一浏览器——如保持用户的登录状态。**Cookie 使基于[无状态](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview#http_是无状态，有会话的)的 HTTP 协议记录稳定的状态信息成为了可能。

Cookie 主要用于以下三个方面：

- [会话状态管理](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies#会话状态管理)

  如用户登录状态、购物车、游戏分数或其他需要记录的信息

- [个性化设置](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies#个性化设置)

  如用户自定义设置、主题和其他设置

- [浏览器行为跟踪](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies#浏览器行为跟踪)

  如跟踪分析用户行为等

## cookie示例

### WelcomeController

~~~java
// cookie示例

@RequestMapping(path = "/cookie/set", method = RequestMethod.GET)
@ResponseBody
public String setCookie(HttpServletResponse response) {
    // 创建cookie
    Cookie cookie = new Cookie("code", CommunityUtil.generateUUID());
    // 设置cookie生效的范围
    cookie.setPath("/community/welcome");
    // 设置cookie的生存时间
    cookie.setMaxAge(60 * 10);
    // 发送cookie
    response.addCookie(cookie);

    return "set cookie";
}
~~~

### 验证

进入链接，浏览器-->检查--->网络

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/06/07/55680_image-20240607112606890.png" alt="image-20240607112606890" style="zoom: 67%;" />

### /cookie/get验证

~~~java
@RequestMapping(path = "/cookie/get", method = RequestMethod.GET)
@ResponseBody
public String getCookie(@CookieValue("code") String code) {
    System.out.println(code);
    return "get cookie";
}
~~~

`@CookieValue`获取cookie值

## session

是JavaEE的标准，用于在服务端记录客户端信息。
数据存放在服务端更加安全，但是也会增加服务端的内存压力。

### WelcomeController

~~~java
@RequestMapping(path = "/session/set", method = RequestMethod.GET)
@ResponseBody
public String setSession(HttpSession session) {
    session.setAttribute("id", 1);
    session.setAttribute("name", "Test");
    return "set session";
}

@RequestMapping(path = "/session/get", method = RequestMethod.GET)
@ResponseBody
public String getSession(HttpSession session) {
    System.out.println(session.getAttribute("id"));
    System.out.println(session.getAttribute("name"));
    return "get session";
}
~~~

