---
title: 牛客论坛项目-发送邮件
categories:
- nowcoder
tags:
- forum
- nowcoder
---
<meta name="referrer" content="no-referrer"/>

## 内容

**本节包括：**

- 环境准备
- JavaMailSender

<!--more-->

## spring email

### 依赖导入

~~~xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
    <version>3.0.11</version>
</dependency>
~~~

### 邮箱参数配置

发送方

~~~java
spring.mail.host=smtp.163.com
spring.mail.port=465
spring.mail.username=xxxxxx@163.com
spring.mail.password=xxxxx
spring.mail.protocol=smtps
spring.mail.properties.mail.smtp.ssl.enable=true
~~~

一定要要注意邮箱有没有写错，要开启相应服务，使用授权码

![image-20240605220710410](https://gitee.com/hollis7/pictures/raw/master/2024/06/05/23017_image-20240605220710410.png)

### JavaMailSender发送邮件

~~~java
package com.hdb.community.util;
@Component
public class MailClient {
    private static final Logger logger = LoggerFactory.getLogger(MailClient.class);

    @Autowired
    private JavaMailSender mailSender;

    @Value("${spring.mail.username}")
    private String from;

    public void sendMail(String to, String subject, String content) {
        try {
            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message);
            helper.setFrom(from);
            helper.setTo(to);
            helper.setSubject(subject);
            helper.setText(content, true);
            mailSender.send(helper.getMimeMessage());
        } catch (MessagingException e) {
            logger.error("发送邮件失败:" + e.getMessage());
        }
    }

}
~~~

~~~java
@Autowired
    private MailClient mailClient;
@Test
public void testTextMail() {
    mailClient.sendMail("3090810541@qq.com", "TEST", "Welcome.");
}
~~~



## 模板引擎

### 使用thymeleaf发送html邮件

`templates/mail`目录下的创建email模板

导入模板引擎`TemplateEngine`，生成动态html，发送邮件

~~~java
@Autowired
private TemplateEngine templateEngine;

@Test
public void testHtmlMail() {
    Context context = new Context();
    context.setVariable("username", "sunday");

    String content = templateEngine.process("/mail/demo", context);
    System.out.println(content);

    mailClient.sendMail("3090810541@qq.com", "HTML", content);
}
~~~

~~~html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>邮件示例</title>
</head>
<body>
<p>欢迎你, <span style="color:red;" th:text="${username}"></span>!</p>
</body>
</html>
~~~

