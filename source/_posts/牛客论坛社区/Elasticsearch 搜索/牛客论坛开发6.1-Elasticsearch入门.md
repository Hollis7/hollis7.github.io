---
title: 牛客论坛项目-Elasticsearch入门
categories:
- nowcoder
tags:
- Elastic
- nowcoder
---
<meta name="referrer" content="no-referrer"/>

## 内容

**本节包括：**

- elasticsearch安装
- elasticsearch配置
- elasticsearch入门使用

<!--more-->

## elasticsearch安装

下载6.4.3windows版本

### 配置elasticsearch.yml

~~~yaml
cluster.name: nowcoder
path.data: D:\data\community_demo\elasticsearch\data
path.logs: D:\data\community_demo\elasticsearch\logs
~~~

### 配置环境变量

在path新加一条

```
C:\data\mysoftware\elasticsearch-6.4.3\bin
```

### 安装中文分词插件

github搜索`elasticsearch ik`，现在改名为：[analysis-ik](https://github.com/infinilabs/analysis-ik)

在`C:\data\mysoftware\elasticsearch-6.4.3\plugins`目录下创建`ik`，解压`elasticsearch-analysis-ik-6.4.3.zip`在`ik`目录下。

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/06/28/64461_image-20240628202115207.png" alt="image-20240628202115207" style="zoom: 80%;" />

### 报错

启动报错，Elasticsearch Unrecognized VM option 'UseConcMarkSweepGC'，解决方法

```
Add "-XX:+IgnoreUnrecognizedVMOptions" to your JVM option
```

### 校验-powershell

#### 命令更正

输入命令：

~~~bash
Invoke-WebRequest -Uri "http://localhost:9200/_cat/health?v" -Method Get
~~~

不再是

```
curl -X GET "localhost:9200/_cat/health?v"
```

> 在 PowerShell 中，`curl` 是 `Invoke-WebRequest` 的别名，而 `Invoke-WebRequest` 不接受 `-X` 参数。相反，你可以直接使用 `Invoke-WebRequest` 命令，并且需要将请求的方法指定为 `Method` 参数。

查看节点

~~~bash
Invoke-WebRequest -Uri "http://localhost:9200/_cat/nodes?v" -Method Get
~~~

#### 查看索引

```bash
Invoke-WebRequest -Uri "http://localhost:9200/_cat/indices?v" -Method Get
```

~~~bash
Invoke-WebRequest -Uri "http://localhost:9200/test" -Method put
~~~

![image-20240628205757661](https://gitee.com/hollis7/pictures/raw/master/2024/06/28/38294_image-20240628205757661.png)

~~~bash
Invoke-WebRequest -Uri "http://localhost:9200/_cat/indices?v" -Method Get
~~~

![image-20240628205912212](https://gitee.com/hollis7/pictures/raw/master/2024/06/28/70857_image-20240628205912212.png)

#### 删除索引

~~~bash
 Invoke-WebRequest -Uri "http://localhost:9200/test" -Method DELETE
~~~

### 校验-postman

输入（put）

~~~bash
http://localhost:9200/test
~~~

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/06/28/54049_image-20240628210554474.png" alt="image-20240628210554474" style="zoom: 80%;" />

输入（delete）

~~~bash
http://localhost:9200/test
~~~

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/06/28/68025_image-20240628210841510.png" alt="image-20240628210841510"  />

更复杂一点

![image-20240628211214121](https://gitee.com/hollis7/pictures/raw/master/2024/06/28/51815_image-20240628211214121.png)

![image-20240628211323213](https://gitee.com/hollis7/pictures/raw/master/2024/06/28/11790_image-20240628211323213.png)

删除，切换为delete

## es搜索

### put输入

~~~bash
http://localhost:9200/test/_doc/1
{"title":"还联网求职",
"content":"寻求后端开发的java岗位"
}
~~~

~~~bash
http://localhost:9200/test/_doc/2
{"title":"还联网招聘",
"content":"招聘厨师一位，工资日结"
}
~~~

~~~bash
http://localhost:9200/test/_doc/3
{"title":"大学老师招聘",
"content":"诚心求一位大学老师"
}
~~~

#### 搜索

### 全部搜索（get）

~~~bash
localhost:9200/test/_search
~~~

结果

~~~json
{
    "took": 67,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 3,
        "max_score": 1.0,
        "hits": [
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "2",
                "_score": 1.0,
                "_source": {
                    "title": "还联网招聘",
                    "content": "招聘厨师一位，工资日结"
                }
            },
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "1",
                "_score": 1.0,
                "_source": {
                    "title": "还联网求职",
                    "content": "寻求后端开发的java岗位"
                }
            },
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "3",
                "_score": 1.0,
                "_source": {
                    "title": "大学老师招聘",
                    "content": "诚心求一位大学老师"
                }
            }
        ]
    }
}
~~~

### 加条件搜索（单一条件）

~~~bash
localhost:9200/test/_search?q=title:老师
~~~

~~~json
{
    "took": 2,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 1,
        "max_score": 0.5753642,
        "hits": [
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "3",
                "_score": 0.5753642,
                "_source": {
                    "title": "大学老师招聘",
                    "content": "诚心求一位大学老师"
                }
            }
        ]
    }
}
~~~

~~~bash
localhost:9200/test/_search?q=content:厨师
~~~

~~~json
{
    "took": 1,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 2,
        "max_score": 0.5753642,
        "hits": [
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "2",
                "_score": 0.5753642,
                "_source": {
                    "title": "还联网招聘",
                    "content": "招聘厨师一位，工资日结"
                }
            },
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "3",
                "_score": 0.2876821,
                "_source": {
                    "title": "大学老师招聘",
                    "content": "诚心求一位大学老师"
                }
            }
        ]
    }
}
~~~

命中两条的原因可能时`厨师`中有一个`师`字，分词搜说过程中命中了老师

### 多条件搜素

~~~bash
localhost:9200/test/_search
~~~

postman参数body-->raw-->json

~~~json
{
    "query":{
        "multi_match":{
            "query":"老师",
            "fields":["title","content"]
        }
    }
}
~~~

结果

~~~json
{
    "took": 14,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 2,
        "max_score": 0.5753642,
        "hits": [
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "3",
                "_score": 0.5753642,
                "_source": {
                    "title": "大学老师招聘",
                    "content": "诚心求一位大学老师"
                }
            },
            {
                "_index": "test",
                "_type": "_doc",
                "_id": "2",
                "_score": 0.2876821,
                "_source": {
                    "title": "还联网招聘",
                    "content": "招聘厨师一位，工资日结"
                }
            }
        ]
    }
}
~~~

