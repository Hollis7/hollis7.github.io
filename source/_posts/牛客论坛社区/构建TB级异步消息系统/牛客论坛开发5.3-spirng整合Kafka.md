---
title: 牛客论坛项目-spring整合Kafka
categories:
- nowcoder
tags:
- Redis
- nowcoder
---
<meta name="referrer" content="no-referrer"/>

## 内容

**本节包括：**

- Kafka的spring实战

<!--more-->

## 总体步骤

引入依赖
- spring-kafka

配置Kafka

- 配置server、consumer

访问Kafka

- 生产者
  - kafkaTemplate.send(topic, data);

- 消费者
  - @KafkaListener(topics = {"test"})
  - public void handleMessage(ConsumerRecord record) {}

## 导入依赖

~~~xml
<dependency>
    <groupId>org.springframework.kafka</groupId>
    <artifactId>spring-kafka</artifactId>
</dependency>
~~~

## 配置Kafka

~~~properties
# KafkaProperties
spring.kafka.bootstrap-servers=xxx.xxx.xxx.xxx:9092
spring.kafka.consumer.group-id=community-consumer-group
spring.kafka.consumer.enable-auto-commit=true
spring.kafka.consumer.auto-commit-interval=3000
~~~

### 坑

具体参考springboot3 [整合部分](https://hollis7.github.io/2024/01/16/springboot3/springboot3_%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/)

一定要修改hosts文件，文件地址

~~~
hosts：
C:\Windows\System32\drivers\etc
~~~

加入ip对应的容器号，不然会报错，unknowhost

```
121.xxx.xxx.4  02c36d608176
```

`02c36d608176`是kafka的容器id

没有输出是因为默认监听是监听最后的消息，在测试运行时没有新消息send，然后结束了程序

### 改进测试代码

```java
@SpringBootTest
public class KafkaTests {

    @Autowired
    private KafkaProducer kafkaProducer;

    @Test
    public void testKafka() {
        kafkaProducer.sendMessage("test", "你好");
        kafkaProducer.sendMessage("test", "在吗");

        try {
            Thread.sleep(1000 * 2);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

}

@Component
class KafkaProducer {

    @Autowired
    private KafkaTemplate kafkaTemplate;

    public void sendMessage(String topic, String content) {
        kafkaTemplate.send(topic, content);
    }

}

@Component
class KafkaConsumer {

    @KafkaListener(
            topicPartitions = {
                    @TopicPartition(topic = "test",
                            partitionOffsets = {
                                    @PartitionOffset(partition = "0", initialOffset = "0")
                            })
            })
    public void listenAllRecords(ConsumerRecord record) {
        Object value = record.value();
        System.out.println("收到消息, value:" + value);
    }


}
```