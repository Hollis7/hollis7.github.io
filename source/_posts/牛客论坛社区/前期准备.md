---
title: 牛客论坛项目-前期
categories:
- nowcoder
tags:
- forum
- nowcoder
---
<meta name="referrer" content="no-referrer"/>

## 内容

**本节包括：**

- springMVC
- SpringBoot
- MyBatis

<!--more-->

## idea环境搭建

### 安装maven

配置user setting file

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/05/29/93211_image-20240529114248035.png" alt="image-20240529114248035" style="zoom:50%;" />

### 创建maven项目

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/05/29/26610_image-20240529103158428.png" alt="image-20240529103158428" style="zoom:67%;" />

## IoC

IoC：Inversion of Control控制反转。传统的Java项目是程序员手动用new来实例化对象，而Spring是用IoC容器来管理对象（Spring中把需要管理的对象称为Bean）

控制：即实例化对象的权力
反转：由程序员手动用new关键词实例化变为Spring IoC容器管理实例化对象

### 容器

Spring容器是一个管理Bean的容器，在Spring的定义里，所有IoC容器都要实现接口BeanFactory

由于`BeanFactory`功能不够强大，因此在BeanFactory的基础上还设计了一个更高级的接口`ApplicationContext`。ApplicationContext是BeanFactory的子接口，除此之外，ApplicationContext还提供了集成AOP、管理消息资源、发布事件、在应用层注入上下文等信息

### @SpringBootApplication

我们可以把 `@SpringBootApplication`看作是 `@Configuration、@EnableAutoConfiguration、@ComponentScan` 注解的集合。
其中
@Configuration：代表这是一个Java配置类
@ComponentScan：扫描被@Component (@Service、@Controller、@Mapper等)注解的 Bean
@EnableAutoConfiguration：启用 SpringBoot 的自动配置机制

### 依赖注入

@Autowired会根据属性找到对应的Bean并注入。

`@Primary`告诉IoC容器，当有多个同类型的Bean时，优先使用我注入

`@Primary`可能修饰多个类，此时就不能单用@Primary来消除歧义，`@Qualifier`的配置项value需要一个字符串定义，这样Autowired就会通过类型和名称一起找到Bean

## spirngMVC入门

### HTTP 报文

<img src="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview/http_request.png" alt="一个基础的 HTTP 请求" style="zoom:50%;" />

### 架构设计

1. 三层架构
   -表现层、业务层、数据访问层
2. MVC
   -Model:模型层
   -View:视图层
   -Controller:控制层
3. 核心组件
   -前端控制器：DispatcherServlet

<img src="https://gitee.com/hollis7/pictures/raw/master/2024/06/03/93206_image-20240603164921159.png" alt="image-20240603164921159" style="zoom: 33%;" />

### thymeleaf

开发是 建议关闭`thymeleaf`缓存，实时更新页面，部署时打开

~~~properties
spring.thymeleaf.cache=false
~~~

[手册](https://docs.spring.io/spring-boot/docs/3.2.7-SNAPSHOT/reference/html/application-properties.html#appendix.application-properties)

### GET

#### @RequestMapping@RequestParam

```java
@RequestMapping(path = "/students", method = RequestMethod.GET)
@ResponseBody
public String getStudents(
        @RequestParam(name = "current", required = false, defaultValue = "1") int current,
        @RequestParam(name = "limit", required = false, defaultValue = "10") int limit) {
    System.out.println(current);
    System.out.println(limit);
    return "some students";
}
```

#### @RequestMapping@PathVariable

~~~java
@RequestMapping(path = "/students/{id}", method = RequestMethod.GET)
@ResponseBody
public String getStudent(@PathVariable("id") int id) {
    System.out.println(id);
    return "a student";
}
~~~

### POST

~~~java
@RequestMapping(path = "/students", method = RequestMethod.POST)
@ResponseBody
public String saveStudent(String name, int age) {
    System.out.println(name);
    System.out.println(age);
    return "success";
}
~~~

static/student.html

~~~html
<form method="post" action="/community/welcome/students">
    <p>
        姓名：<input type="text" name="name">
    </p>
    <p>
        年龄：<input type="text" name="age">
    </p>
    <p>
        <input type="submit" name="save">
    </p>
</form>
~~~

### 响应HTML数据

#### ModelAndView addObject

~~~java
@RequestMapping(path = "/teacher", method = RequestMethod.GET)
public ModelAndView getTeacher() {
    ModelAndView mav = new ModelAndView();
    mav.addObject("name", "张三");
    mav.addObject("age", 30);
    mav.setViewName("/demo/view");
    return mav;
}
~~~
#### Model addAttribute(推荐)

```java
@RequestMapping(path = "/school", method = RequestMethod.GET)
public String getSchool(Model model) {
    model.addAttribute("name", "北京大学");
    model.addAttribute("age", 80);
    return "/demo/view";
}
```

### 响应JSON数据

~~~java
@RequestMapping(path = "/emp", method = RequestMethod.GET)
@ResponseBody
public Map<String, Object> getEmp() {
    Map<String, Object> emp = new HashMap<>();
    emp.put("name", "张三");
    emp.put("age", 23);
    emp.put("salary", 8000.00);
    return emp;
}
~~~

## MyBatis

### Mysql和MyBatis配置

~~~properties
# DataSourceProperties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&useSSL=false&serverTimezone=Hongkong
spring.datasource.username=root
spring.datasource.password=passwd
spring.datasource.type=com.zaxxer.hikari.HikariDataSource
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=30000
# MybatisProperties
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.hdb.community.entity
mybatis.configuration.useGeneratedKeys=true
mybatis.configuration.mapUnderscoreToCamelCase=true
~~~

### 构造实体User

~~~java
package com.hdb.community.entity;
@Data
public class User {
    private int id;
    private String username;
    private String password;
    private String salt;
    private String email;
    private int type;
    private int status;
    private String activationCode;
    private String headerUrl;
    private Date createTime;
}
~~~

### 构建UserMapper

操作数据库数据的接口

~~~java
package com.hdb.community.dao;
@Mapper
public interface UserMapper {
    User selectById(int id);

    User selectByName(String username);

    User selectByEmail(String email);

    int insertUser(User user);

    int updateStatus(int id, int status);

    int updateHeader(int id, String headerUrl);

    int updatePassword(int id, String password);

}
~~~

### 配置user-mapper.xml

#### 插入

~~~xml
<sql id="insertFields">
    username
    , password, salt, email, type, status, activation_code, header_url, create_time
</sql>
<insert id="insertUser" parameterType="User" keyProperty="id">
    insert into user(<include refid="insertFields"></include>) values
    (#{username},#{password},#{salt},#{email},#{type},#{status},#{activationCode}, #{headerUrl}, #{createTime})
</insert>
~~~

- `parameterType="User"`此参数指定了传递给 `insertUser` 操作的参数类型。在本例中，参数类型为 `User`，表示该方法将接收一个 `User` 对象作为参数。
- `keyProperty="id"`此参数用于指定将要插入记录的主键值应该映射到 `User` 对象的哪个属性。在本例中，`keyProperty` 设置为 "id"，这意味着 MyBatis 会将数据库生成的 ID 值赋值给 `User` 对象的 `id` 属性。

#### 更新

~~~xml
<update id="updateStatus">
    update user
    set status = #{status}
    where id = #{id}
</update>
<update id="updateHeader">
~~~

### debug模式

为了调试时能发现mybatis的sql语法错误，因此将模式调整为debug模式

~~~properties
logging.level.com.hdb.community.dao=debug
建议：
logging.level.com.hdb.community=debug
~~~

